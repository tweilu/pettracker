<h1 class="page-header">
  <%= @pet.name %>
  <span id="petsitter-info" class="pull-right">
    <% if @pet.owner != current_user %>
      <small>
        Owner: <%= @pet.owner.name %> | <%= link_to "Stop Sitting", pets_stopsitting_path(:petid => @pet.id), :confirm=>'Are you sure you would like to stop sitting this pet?' %>
      </small>
    <% else %>
      <% if @pet.sitter.nil? %>
        <%= render 'petsitter_form' %>
      <% else %>
        <small>
          Sitter: <%= @pet.sitter.name %> | <%= link_to "Remove", pets_removesitter_path(:petid => @pet.id), :confirm=>'Are you sure you would like to remove the sitter?', :remote => true %>
        </small>
      <% end %>
    <% end %>
  </span>
</h1>

<div class="row">
  <div class="col-md-9">

    <div class="pull-left">
      <img class="pet-pic" src="http://placehold.it/190&text=my+pet" />
    </div>
    <h1><small>Located in <%= @pet.owner.location %></small></h1>
    <p class="pet-description-text"><%= @pet.description %></p>
    
  </div>


  <div class="col-md-3 calendar cal-hover">
    <h3>Appointments</h3>
    <div id="calendar"></div>
  </div>

</div>

<div id="add-event">
  <%= form_tag pets_addevent_path, :method => :post, :remote => true do %>
    <%= hidden_field_tag :event_date, nil, :id => 'event_date' %>
    <%= hidden_field_tag :pet_id, @pet.id %>
    <%= text_field_tag 'event_name', nil, {:class => 'form-control input-sm', :placeholder => 'New Appointment', :id => 'add-event-field'} %>
    <%= text_field_tag 'event_time', nil, {:class => 'form-control input-sm', :placeholder => 'Appointment Time', :id => 'event-time-field'} %>
    <%= button_tag(type: 'submit', class: 'btn btn-default btn-xs', :id => 'add-event-btn', :name => 'add_event') do %>
      Add
    <% end %>
    <%= button_tag(type: 'submit', class: 'btn btn-default btn-xs', :id => 'cancel-event-btn', :name => 'cancel_event') do %>
      Cancel
    <% end %>
  <% end %>
</div>

<div id="event-info">
  <div>
    <a href="#" id="close-event-info">&times;</span></a>
  </div>
  <div id="event-info-content">
  </div>
  <div>
    <%= form_tag pets_deleteevent_path, :id => 'deleteevent', :method => :post, :remote => true do %>
      <%= hidden_field_tag :event_id, nil, :id => 'event_id' %>
      <%= hidden_field_tag :pet_id, @pet.id %>
      <%= link_to "#", :onclick=>"$('#deleteevent').submit()" do %>
        <span class="glyphicon glyphicon-trash"></span>
      <% end %>
    <% end %>
  </div>
</div>


<script>
  $(document).ready(function() {
    $('#calendar').fullCalendar({
      // put your options and callbacks here
      events: <%= raw @events.to_json %>,

      eventClick: function(calEvent, jsEvent, view) {

        $('#event-info').css({'display':'inline', 'position':'absolute', 'left':jsEvent.pageX-210, 'top':jsEvent.pageY});
        $('#event-info-content').html('<p>'+calEvent.title+'<br />'+calEvent.time+'</p>');
        $('#event_id').val(calEvent.id);

      },
      dayClick: function(date, allDay, jsEvent, view) {

        $('#add-event').css({'display':'inline', 'position':'absolute', 'left':jsEvent.clientX-210, 'top':jsEvent.clientY});
        $('#event_date').val(date);

      },
    });
    $('#close-event-info').click(function(e) {
      e.preventDefault();
      $('#event-info').css({'display':'none'});
      $('#event-info-content').html('');
    });
  });
</script>




















